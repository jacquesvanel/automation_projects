---
- name: Copy cert files to /var/lib/mongodb/cert
  hosts: "{{ target }}"
  become: yes
  tasks:

    - name: make openldap directory
      file:
        path: /etc/openldap
        state: directory
        owner: root
        group: root
    
    - name: make ldap certs directory
      file:
        path: /etc/openldap/certs/
        state: directory
        owner: root
        group: root

    - name: make ldap certs directory
      file:
        path: /var/lib/mongodb/cert/
        state: directory
        owner: root
        group: root
    
    - name: get ldap.conf
      get_url:
        url: https://va1artifactoryirs.mgt.afsiep.net:443/artifactory/Linux-Shared/MongoDB/keys/ldap.conf
        dest: /etc/openldap/ldap.conf
        owner: mongod
        group: opr-db-admin
        mode: '0600'

    - name: get iep cert
      get_url: 
        url: https://va1artifactoryirs.mgt.afsiep.net:443/artifactory/Linux-Shared/MongoDB/keys/iep_root_intermediate.pem
        dest: /etc/openldap/certs/iep_root_intermediate.pem
        owner: mongod
        group: opr-db-admin
        mode: '0600'
    
    - name: get ca cert
      get_url:
        url: https://va1artifactoryirs.mgt.afsiep.net:443/artifactory/Linux-Shared/MongoDB/keys/CA_Root_Inter.pem
        dest: /var/lib/mongodb/cert/CA_Root_Inter.pem
        owner: mongod
        group: opr-db-admin
        mode: '0600'

    - name: copy mongo database BI into /usr/local/bin
      unarchive:
        src: https://va1artifactoryirs.mgt.afsiep.net/artifactory/Linux-Shared/MongoDB/mongodb-bi-linux-x86_64-rhel80-v2.14.4.tgz
        dest: /usr/local/bin/
        remote_src: yes
        list_files: yes

