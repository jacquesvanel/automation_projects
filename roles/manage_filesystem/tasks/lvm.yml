---
#gets existing volgroup
- set_fact:
    vgs_name: "{{ item.key }}"
  with_dict: "{{ ansible_lvm.vgs }}"

- debug:
    var: vgs_name

- set_fact:
    lvs_name: "{{ item.key }}"
  loop: "{{ ansible_lvm.lvs | list }}"

- debug:
    var: lvs_name

- set_fact:
    lv_name: data

- debug:
    var: lv_name
#creates data lvm
- block:    
  - name: Create logical volume
    lvol:
      vg: "{{ vgs_name }}"
      lv: "{{ lv_name }}" 
      size: 10G
    register: lv_create
    ignore_errors: yes

  - name: Format logical volume
    filesystem:
      fstype: xfs
      dev: "/dev/{{ vgs_name }}/{{ lv_name }}"
    when: lv_create.changed
    register: lv_format
    ignore_errors: yes

  - name: Creates directory
    file:
      path: /{{ lv_name }}
      state: directory
    when: lv_format.changed

  - name: Mount logical volume
    mount:
      path: /{{ lv_name }}
      src: /dev/{{ vgs_name }}/{{ lv_name }}
      fstype: xfs
      state: mounted
    when: lv_format.changed
    ignore_errors: yes
    #  with_dict: "{{ ansible_lvm.lvs }}"
  when: lvs_name != "data" 
