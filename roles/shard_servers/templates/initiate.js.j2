#jinja2: lstrip_blocks: "True"
{% if shard1a is defined and ansible_hostname == shard1a %}
config = { _id: "{{ item.repset }}",
        members:[
         { _id : 0, host : "{{ shard1a }}.opr.afsiep.net:{{ shard1a_port }}", priority: 100 },
{% if shard1b is defined and shard1b|length %}
         { _id : 1, host : "{{ shard1b }}.opr.afsiep.net:{{ shard1b_port }}" },
{% endif %}
{% if shard1c is defined and shard1c|length %}
         { _id : 2, host : "{{ shard1c }}.opr.afsiep.net:{{ shard1c_port }}" }
{% endif %}
        ]
};
var output = rs.initiate(config);
printjson(output)
{% elif shard2a is defined and ansible_hostname == shard2a %}
config = { _id: "{{ item.repset }}",
        members:[
         { _id : 0, host : "{{ shard2a }}.opr.afsiep.net:{{ shard2a_port }}", priority: 100 },
{% if shard2b is defined and shard2b|length %}
         { _id : 1, host : "{{ shard2b }}.opr.afsiep.net:{{ shard2b_port }}" },
{% endif %}
{% if shard2c is defined and shard2c|length %}
         { _id : 2, host : "{{ shard2c }}.opr.afsiep.net:{{ shard2c_port }}" }
{% endif %}
        ]
};
var output = rs.initiate(config);
printjson(output)
{% elif shard3a is defined and ansible_hostname == shard3a %}
config = { _id: "{{ item.repset }}",
        members:[
         { _id : 0, host : "{{ shard3a }}.opr.afsiep.net:{{ shard3a_port }}", priority: 100 },
{% if shard3b is defined and shard3b|length %}
         { _id : 1, host : "{{ shard3b }}.opr.afsiep.net:{{ shard3b_port }}" },
{% endif %}
{% if shard3c is defined and shard3c|length %}
         { _id : 2, host : "{{ shard3c }}.opr.afsiep.net:{{ shard3c_port }}" }
{% endif %}
        ]
};
var output = rs.initiate(config);
printjson(output)
{% endif %}
