systemLog:
  destination: file
{% if item is defined and item == 'mongos0' %}
  path: "/var/log/mongodb/{{ env }}/mongos0.log"
{% endif %}
{% if item is defined and item == 'mongos1' %}
  path: "/var/log/mongodb/{{ env }}/mongos1.log"
{% endif %}
{% if item is defined and item == 'mongos2' %}
  path: "/var/log/mongodb/{{ env }}/mongos2.log"
{% endif %}
  logAppend: true
  logRotate: reopen
processManagement:
  fork: true
{% if item is defined and item == 'mongos0' %}
  pidFilePath: "/var/run/mongodb/{{ env }}/mongos-37017.pid"
{% endif %}
{% if item is defined and item == 'mongos1' %}
  pidFilePath: "/var/run/mongodb/{{ env }}/mongos-37018.pid"
{% endif %}
{% if item is defined and item == 'mongos2' %}
  pidFilePath: "/var/run/mongodb/{{ env }}/mongos-37019.pid"
{% endif %}
security:
   clusterAuthMode: x509
   ldap:
      servers: "opr.afsiep.net:636"
      bind:
{% if env is defined and env == 'prod' %}
         queryUser: "svc_mdbprd_ldap@opr.afsiep.net"
         queryPassword: "MI!iseji7ubope"
{% else %}
         queryUser: "svc_mdbnprd_ldap@opr.afsiep.net"
         queryPassword: "36W=qR*AeoI0:h"
{% endif %}
      transportSecurity: tls
      userToDNMapping:
         '[
            {
               match : "(.+)",
               ldapQuery: "ou=IEP,DC=opr,DC=afsiep,DC=net??sub?(userPrincipalName={0})"
            }
         ]'
setParameter:
   authenticationMechanisms: PLAIN, SCRAM-SHA-1, SCRAM-SHA-256
   ocspEnabled: false
net:
{% if item is defined and item == 'mongos0' %}
  port: 37017
{% endif %}
{% if item is defined and item == 'mongos1' %}
  port: 37018
{% endif %}
{% if item is defined and item == 'mongos2' %}
  port: 37019
{% endif %}
  bindIp: localhost,{{ ansible_hostname }}.opr.afsiep.net
  tls:
   mode: preferTLS
   CAFile: /var/lib/mongodb/cert/CA_Root_Inter.pem
   allowConnectionsWithoutCertificates: true
   certificateKeyFile: /var/lib/mongodb/cert/KeyWCert.pem
   certificateKeyFilePassword: 22w#SBR5nfvZOt23
sharding:
  configDB: config_{{ env }}/{{ configsvr_rsa }}.opr.afsiep.net:57040,{{ configsvr_rsb }}.opr.afsiep.net:57041,{{ configsvr_rsc }}.opr.afsiep.net:57042
