---
################################  testing  ################################


##########start of config##################################################
- name: add mongo service file
  import_tasks: mongo_service.yml
  tags:
    - reinstall
    - mongo_service

- name: add single_repset_svr config/service files
  import_tasks: no_sec_servers.yml
  tags:
    - no_sec_servers

- name: setup users
  import_tasks: setup_users.yml
  when:  ansible_hostname == {{ item.name }} and item.name == 'rs_1'
  with_items: "{{ db_servers }}"
  tags: 
    - setup_users

- name: create role
  import_tasks: create_role.yml
  when:  ansible_hostname == {{ item.name }} and item.name == 'rs_1'
  with_items: "{{ db_servers }}"
  tags: 
    - create_role
    
- name: change ldap interval
  import_tasks: ldap_interval.yml
  when:  ansible_hostname == {{ item.name }} and item.name == 'rs_1'
  with_items: "{{ db_servers }}"
  tags:
    - ldap_interval  

- name: add configsvr config/service files
  import_tasks: servers.yml
  tags:
    - servers

- name: initiate clusters
  import_tasks: initiate_clusters.yml
  when:  ansible_hostname == {{ item.name }} and item.name == 'rs_1'
  with_items: "{{ db_servers }}"
  tags:
    - initiate_clusters

- name: add keep alive line to sysctl.conf
  import_tasks: add_line_to_sys.yml
  tags:
    - keepalive

- name: start mongo
  systemd:
    name: mongo
    state: restarted

- name: mms agent
  import_tasks: mms_agent.yml
  tags:
    - mms_agent
#####################################################################
