systemLog:
  destination: file
{% if shard1a is defined and ansible_hostname == shard1a %}
  path: "/var/log/mongodb/{{ env }}/sh1-rs_a.log"
{% endif %}
{% if shard1b is defined and ansible_hostname == shard1b %}
  path: "/var/log/mongodb/{{ env }}/sh1-rs_b.log"
{% endif %}
{% if shard1c is defined and ansible_hostname == shard1c %}
  path: "/var/log/mongodb/{{ env }}/sh1-rs_c.log"
{% endif %}
  logAppend: true
  logRotate: reopen
processManagement:
  fork: true 
{% if shard1a is defined and ansible_hostname == shard1a %}
  pidFilePath: "/var/run/mongodb/{{ env }}/mongod-sh1-rs_a.pid"
{% endif %}
{% if shard1b is defined and ansible_hostname == shard1b %}
  pidFilePath: "/var/run/mongodb/{{ env }}/mongod-sh1-rs_b.pid"
{% endif %}
{% if shard1c is defined and ansible_hostname == shard1c %}
  pidFilePath: "/var/run/mongodb/{{ env }}/mongod-sh1-rs_c.pid"
{% endif %}
security:
   authorization: "enabled"
   clusterAuthMode: x509
   ldap:
      servers: "opr.afsiep.net:636"
      bind:
{% if env is defined and env == 'prod' %}
         queryUser: "{{ prod_user }}" 
         queryPassword: "{{ prod_pw }}"
{% else %}
         queryUser: "{{ nonprod_user }}"
         queryPassword: "{{ nonprod_pw }}"
{% endif %}
      transportSecurity: tls
      userToDNMapping:
         '[
            {
               match : "(.+)",
               ldapQuery: "ou=IRS,DC=opr,DC=afsiep,DC=net??sub?(userPrincipalName={0})"
            },
            {
               match : "(.+)",
               ldapQuery: "ou=IEP,DC=opr,DC=afsiep,DC=net??sub?(userPrincipalName={0})"
            }
         ]'
      authz:
         queryTemplate: "{USER}?memberOf?base"
setParameter:
   authenticationMechanisms: PLAIN, SCRAM-SHA-1, SCRAM-SHA-256
   ocspEnabled: false
   ldapUserCacheInvalidationInterval: 86400
   ldapConnectionPoolMaximumConnectionsPerHost: 2147483647
   ldapConnectionPoolMaximumConnectionsInProgressPerHost: 2147483647
net:
{% if shard1a is defined and ansible_hostname == shard1a %}
  port: {{ shard1a_port }}
{% endif %}
{% if shard1b is defined and ansible_hostname == shard1b %}
  port: {{ shard1b_port }}
{% endif %}
{% if shard1c is defined and ansible_hostname == shard1c %}
  port: {{ shard1c_port }}
{% endif %}
  bindIp: localhost,{{ ansible_hostname }}.opr.afsiep.net
  tls:
   mode: preferTLS
   CAFile: /var/lib/mongodb/cert/CA_Root_Inter.pem
   allowConnectionsWithoutCertificates: true
   certificateKeyFile: /var/lib/mongodb/cert/KeyWCert.pem
   certificateKeyFilePassword: {{ cert_password }}
sharding:
  clusterRole: shardsvr
replication:
  replSetName: sh1_{{ env }}
storage:
{% if shard1a is defined and ansible_hostname == shard1a %}
  dbPath: /data/{{ env }}/shard1/rs_a
{% endif %}
{% if shard1b is defined and ansible_hostname == shard1b %}
  dbPath: /data/{{ env }}/shard1/rs_b
{% endif %}
{% if shard1c is defined and ansible_hostname == shard1c %}
  dbPath: /data/{{ env }}/shard1/rs_c
{% endif %}
#  wiredTiger:
#    engineConfig:
#      cacheSizeGB: 2 

