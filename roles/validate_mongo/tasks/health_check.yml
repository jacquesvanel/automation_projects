---
- block:
  - name: get health of repset
    shell: "mongo {{ ansible_fqdn }}:{{ port }}/admin -u {{ svc_ansible_automation }} -p {{ svc_ansible_automation_password }} --eval 'db.adminCommand( { replSetGetStatus: 1 } ).members'  | grep 'stateStr\\|health\\|name' |  awk NF | sed 's/\"//g'"
    register: health
    #when: not secondary.stdout == 'true'
 
  - debug:
      var: health.stdout.split('\n')|replace('\t', '') 
 # - debug:
 #     var: health
 #   failed_when: "'health: 0' in health.stdout"
 #   changed_when: false
  - name: Check health values
    fail:
      msg: "Health check failed"
    when: "'health: 0' in health.stdout"
  #when: secondary.stdout == 'false'