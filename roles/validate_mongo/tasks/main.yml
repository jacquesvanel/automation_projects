---
- name: set facts for env var
  import_tasks: set_fact.yml
  tags:
    - always

- name: check status of mms agent
  import_tasks: agent_state.yml
  tags:
    - agent

- name: check mms agent active process
  import_tasks: processes.yml
  when: service_status.status.ActiveState == 'active'
  tags:
    - processes

- name: check standard processes
  import_tasks: standard_processes.yml
  when: service_status.status.ActiveState == 'inactive'

- name: check disk state
  import_tasks: check_disk.yml
  tags:
    - disk

#Check if server is primary or secondary server
- name: check if server is primary or secondary
  shell: mongo "{{ ansible_fqdn }}":37018/admin -u amkanda -p Qwerty#12345px  --eval 'rs.isMaster().secondary' | sort -r | head -1
  register: secondary

- debug:
    msg: "{{ secondary.stdout }}"

- name: shell script
  import_tasks: shell_script.yml
  when: not secondary.stdout == 'true'
  tags:
    - shell

- name: test
  import_tasks: test.yml
  tags:
    - test
    - never
