---
- name:   Run shell to check the mongo services present
  shell:
    cmd: ps -ef | grep /var/lib/mongodb-mms-automation/mongodb-linux-x86_64-5.0.13-ent/bin/mongod | awk -F " " '{print $10}' | awk 'NR<=3' | awk -F  "/" '{print $4}'
  register: processes

- name: Show output of shell cmd
  debug:
    msg: "{{ processes.stdout }}"

- name: Check if "pre_mongo_process" file exist 
  stat:
    path: /tmp/pre_mongo_process{{ ansible_date_time.date }}
  register: pre_file

- name: Check if "post_mongo_process" file exist 
  stat:
    path: /tmp/post_mongo_process{{ ansible_date_time.date }}
  register: post_file

- name: Send output of running processes pre patching to "pre_mongo_process{{ ansible_date_time.date }}"
  copy:
    content: |
            Running Mongo processes on {{ ansible_hostname }} before patching was:
            {{ processes.stdout_lines }}
    dest: /tmp/pre_mongo_process{{ ansible_date_time.date }}
  when: not pre_file.stat.exists

- name: Send output of running processes post patching to "post_mongo_process{{ ansible_date_time.date }}"
  copy:
    content: |
            Running Mongo processes on {{ ansible_hostname }} After patching on {{ ansible_date_time.date }} was:
              {{ processes.stdout_lines }}
    dest: /tmp/post_mongo_process{{ ansible_date_time.date }}
  when: pre_file.stat.exists
