---
# tasks file for mongo_config
- name: make dbpath file directory /data/{{ env }}/config/{{ repset[0] }}
  ansible.builtin.file:
    path: /data/{{ env }}/config/{{ repset[0] }}
    state: directory
    mode: '2770'
    owner: mongod
    group: opr-db-admin

- name: create directory /etc/mongo/{{ env }}
  file: 
    path: "/etc/mongo/{{ env }}/"
    owner: root
    group: root
    mode: '0755'
    state: directory
    
- name: layout template for /etc/mongo/{{ env }}/config.conf on the config server
  template:
    src:  mongod_config1.conf.j2
    dest: "/etc/mongo/{{ env }}/config.conf"
    owner: root
    group: root
    mode: '0644'

- name: layout template for added mongod.service on the server
  template:
    src: mongod.service.j2 
    dest: "/usr/lib/systemd/system/mongod.service"
    owner: root
    group: root
    mode: '0640'

- name: start and enable mongod.service
  systemd:
    name: mongod
    state: stopped 
    enabled: yes
    daemon_reload: yes


