---
- name: Stop mongod service
  systemd:
    name: mongod
    state: stopped
    enabled: no

- name: uninstall mongo services
  yum:
    name: "{{ packages }}"
    #  - mongodb-enterprise-cryptd-5.0.8-1.el8.x86_64
    #  - mongodb-enterprise-shell-5.0.8-1.el8.x86_64
    #  - mongodb-enterprise-server-5.0.8-1.el8.x86_64
    #  - mongodb-enterprise-mongos-5.0.8-1.el8.x86_64
    state: absent

- name: stop and disable hugepages_service
  systemd:
    name: mongodb-hugepage-fix
    state: stopped
    enabled: no
    daemon_reload: yes

- name: delete directory {{ item }}
  file:
    path: {{ item }}
    state: absent
    with_items: 
      - /var/log/mongo/{{ env }}
      - /var/run/mongo/{{ env }}
      - /data/{{ env }}
      - /var/lib/mongo/cert
      - /etc/mongo
      - /etc/logrotate.d/mongo
      - /etc/systemd/system/mongodb-hugepage-fix.service  


