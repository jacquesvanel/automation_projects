---
#CHECKING THE TYPE OF MONGODB IN PROD
- name: Check type of host (for PROD envi)
  shell:
    cmd: " cat /etc/mongo//pte_defunct_managed_by_ops_now/rs_a.cfg | grep -i 'clusterRole: configsvr' "
  register: config_proda
  when:
    - envi.stdout == "prod"
    - config_file_rs_a_prod.stat.exists

- name: Check type of host (for PROD shard1_rs_a envi)
  shell:
    cmd: "cat /etc/mongo/pte_defunct_managed_by_ops_now/shard1_rs_a.cfg |  grep -i 'clusterRole: shardsvr'"
  register: shard_proda
  when:
    - envi.stdout == "prod"
    - config_file_shard1_rs_a_prod.stat.exists
  ignore_errors: yes

- name: Check type of host (for PROD envi)
  shell:
    cmd: " cat /etc/mongo/pte_defunct_managed_by_ops_now/rs_b.cfg | grep -i 'clusterRole: configsvr' "
  register: config_prodb
  when:
    - envi.stdout == "prod"
    - config_file_rs_b_prod.stat.exists

- name: Check type of host (for PROD shard1_rs_b envi)
  shell:
    cmd: "cat /etc/mongo/pte_defunct_managed_by_ops_now/shard1_rs_b.cfg |  grep -i 'clusterRole: shardsvr'"
  register: shard_prodb
  when:
    - envi.stdout == "prod"
    - config_file_shard1_rs_b_prod.stat.exists
  ignore_errors: yes

- name: Check type of host (for PROD envi)
  shell:
    cmd: " cat /etc/mongo/pte_defunct_managed_by_ops_now/rs_c.cfg | grep -i 'clusterRole: configsvr' "
  register: config_prodc
  when:
    - envi.stdout == "prod"
    - config_file_rs_c_prod.stat.exists

- name: Check type of host (for PROD shard1_rs_c envi)
  shell:
    cmd: "cat /etc/mongo/pte_defunct_managed_by_ops_now/shard1_rs_c.cfg |  grep -i 'clusterRole: shardsvr'"
  register: shard_prodc
  when:
    - envi.stdout == "prod"
    - config_file_shard1_rs_c_prod.stat.exists
  ignore_errors: yes



###### SHARDED SERVER CHECK
- name: show server type (PROD envi shard1_rs_a)
  debug:
    msg: "{{ ansible_hostname }} is PART OF A SHARDED CLUSTER"
  when:
    - envi.stdout == "prod"
    - config_file_shard1_rs_a_prod.stat.exists
    - "'shardsvr' in shard_proda.stdout"
  ignore_errors: yes
  register: sharded_server_type_a_prod

- name: show server type (PROD envi shard1_rs_b)
  debug:
    msg: "{{ ansible_hostname }} is PART OF A  SHARDED CLUSTER"
  when:
    - envi.stdout == "prod"
    - config_file_shard1_rs_b_prod.stat.exists
    - "'shardsvr' in shard_prodb.stdout"
  ignore_errors: yes
  register: sharded_server_type_b_prod

- name: show server type (PROD envi shard1_rs_c)
  debug:
    msg: "{{ ansible_hostname }} is a PART OF SHARDED CLUSTER"
  when:
    - envi.stdout == "prod"
    - config_file_shard1_rs_c_prod.stat.exists
    - "'shardsvr' in shard_prodc.stdout"
  ignore_errors: yes
  register: sharded_server_type_c_prod


##### REPLICASET SERVER CHECK
- name: show server type (PROD envi)
  debug:
    msg: "{{ ansible_hostname }} is a STAND ALONE MONGODB SERVER"
  when:
    - envi.stdout == "prod"
    - config_file_rs_a_prod.stat.exists
    - config_proda.stdout == ""
  ignore_errors: yes
  register: replicaset_server_type_a_prod

- name: show server type (PROD envi)
  debug:
    msg: "{{ ansible_hostname }} is a STAND ALONE MONGODB SERVER"
  when:
    - envi.stdout == "prod"
    - config_file_rs_b_prod.stat.exists
    - config_prodb.stdout == ""
  ignore_errors: yes
  register: replicaset_server_type_b_prod

- name: show server type (PROD envi)
  debug:
    msg: "{{ ansible_hostname }} is a STAND ALONE MONGODB SERVER"
  when:
    - envi.stdout == "prod"
    - config_file_rs_c_prod.stat.exists
    - config_prodc.stdout == ""
  ignore_errors: yes
  register: replicaset_server_type_c_prod



 #### CONFIG SERVER CHECK
- name: show server type (PROD envi)
  debug:
    msg: "{{ ansible_hostname }} is a CONFIG SERVER"
  when:
    - envi.stdout == "prod"
    - config_file_rs_a_prod.stat.exists
    - "'configsvr' in config_proda.stdout"
  ignore_errors: yes
  register: config_server_type_a_prod

- name: show server type (PROD envi)
  debug:
    msg: "{{ ansible_hostname }} is a CONFIG SERVER"
  when:
    - envi.stdout == "prod"
    - config_file_rs_b_prod.stat.exists
    - "'configsvr' in config_prodb.stdout"
  ignore_errors: yes
  register: config_server_type_b_prod

- name: show server type (PROD envi)
  debug:
    msg: "{{ ansible_hostname }} is a CONFIG SERVER"
  when:
    - envi.stdout == "prod"
     - config_file_rs_a_prod.stat.exists
    - "'configsvr' in config_prodc.stdout"
  ignore_errors: yes
  register: config_server_type_c_prod
