---
- name: Checking if OPS-MANAGER IS INSTALLED OR NOT
  shell:
    cmd: systemctl status mongo* | grep -i mongodb-mms-automation-agent.service | head -1 | awk -F " " '{print $2}'
  register: ops_manager_check
- name: Fail in case ops manager is not present
  fail:
    msg: " OPS MANAGER AGENT IS NOT INSTALLED ON {{ ansible_hostname }} "
  when: "'mongodb-mms-automation-agent.service' not in ops_manager_check.stdout"

- name: Check if OPS-MANAGER AGENT IS RUNNING OR NOT
  shell:
    cmd: systemctl status mongodb-mms-automation-agent.service | awk 'NR<=3' | grep -i running | awk -F " " '{print $3}' | sed 's/(//g' | sed 's/)//g'
  register: ops_manager_status
  when: ops_manager_check.stdout == "mongodb-mms-automation-agent.service"

- name: Fail in case ops manager is not present or running
  fail:
    msg: " OPS MANAGER AGENT IS NOT RUNNING ON {{ ansible_hostname }} "
  when: "'running' not in ops_manager_status.stdout"
