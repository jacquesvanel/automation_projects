---
# tasks file for initiate_mongo
- name: make directory for /etc/mongo/{{ env }}/scripts/
  file:
    dest: /etc/mongo/{{ env }}/scripts/
    state: directory
    owner: mongod
    group: opr-db-admin
    
- name: layout template for /etc/mongo/{{ env }}/scripts/initiate.shard1.json the shard1 server
  template:
    src:  initiate.shard1.js.j2
    dest: "/etc/mongo/{{ env }}/scripts/initiate.shard1.js"
    owner: root
    group: root
    mode: '0644'
    force: yes

- name: initiate shard replica set
  shell: mongo {{ shard1 }}.opr.afsiep.net:37040 /etc/mongo/{{ env }}/scripts/initiate.shard1.js
  register: shell_result
  delegate_to: "{{ shard1 }}"

- debug:
    var: shell_result.stdout_lines
  

