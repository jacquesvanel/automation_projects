[Unit]
Description=mongos
After=syslog.target
After=network.target

[Service]
User=mongod
Group=opr-db-admin
{% if item == mongos0 %}
PIDFile=/var/run/mongodb/{{ env }}/mongos-37017.pid
{% endif %}
{% if item == mongos1 %}
PIDFile=/var/run/mongodb/{{ env }}/mongos-37018.pid
{% endif %}
{% if item == mongos2 %}
PIDFile=/var/run/mongodb/{{ env }}/mongos-37019.pid
{% endif %}
ExecStartPre=/usr/bin/mkdir -p /var/run/mongodb
ExecStartPre=/usr/bin/chown mongod:mongod /var/run/mongodb/{{ env }}
ExecStartPre=/usr/bin/chmod 0755 /var/run/mongodb/{{ env }}
PermissionsStartOnly=true
ExecStart=/usr/bin/mongos --quiet \
{% if item == mongos0 %}
    --config /etc/mongo/{{ env }}/mongos0.cfg
{% endif %}
{% if item == mongos1 %}
    --config /etc/mongo/{{ env }}/mongos1.cfg
{% endif %}
{% if item == mongos2 %}
    --config /etc/mongo/{{ env }}/mongos2.cfg
{% endif %}
LimitFSIZE=infinity
LimitCPU=infinity
LimitAS=infinity
LimitNOFILE=64000
LimitNPROC=64000
TasksAccounting=false

[Install]
WantedBy=multi-user.target
