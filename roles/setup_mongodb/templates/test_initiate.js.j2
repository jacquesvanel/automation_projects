#jinja2: lstrip_blocks: "True"
{% if ansible_hostname == configsvr_rsa and configsvr_rsa is not none %}
{% set members = [
    { "_id": 0, "host": "{{ configsvr_rsa }}.opr.afsiep.net:{{ configsvr_rsa_port }}", "priority": 100 },
    { "_id": 1, "host": "{{ configsvr_rsb }}.opr.afsiep.net:{{ configsvr_rsb_port }}" } if configsvr_rsb is not none,
    { "_id": 2, "host": "{{ configsvr_rsc }}.opr.afsiep.net:{{ configsvr_rsc_port }}" } if configsvr_rsc is not none
] %}
{% elif ansible_hostname == shard1a and shard1a is not none %}
{% set members = [
    { "_id": 0, "host": "{{ shard1a }}.opr.afsiep.net:{{ shard1a_port }}", "priority": 100 },
    { "_id": 1, "host": "{{ shard1b }}.opr.afsiep.net:{{ shard1b_port }}" } if shard1b is not none,
    { "_id": 2, "host": "{{ shard1c }}.opr.afsiep.net:{{ shard1c_port }}" } if shard1c is not none
] %}
{% endif %}

{% if members is defined %}
config = {
    "_id": "{{ 'config' if ansible_hostname == configsvr_rsa else 'sh1' }}_{{ env }}",
    "members": [{% for member in members %}{{ member }}{% if not loop.last %},{% endif %}{% endfor %}]
};
var output = rs.initiate(config);
printjson(output)
{% endif %}

