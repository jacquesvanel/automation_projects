---
#- name: enable repo services
#  shell: subscription-manager repos --enable=AFSIEP_MongoDB_Enterprise_MongoDB5-RHEL8-x86_64

- name: install mongo services
  yum:
    name:
      - mongodb-enterprise.x86_64
      - mongodb-enterprise-cryptd.x86_64
      - mongodb-enterprise-shell.x86_64
      - mongodb-enterprise-server.x86_64
      - mongodb-enterprise-mongos.x86_64
      - mongodb-database-tools.x86_64
      - mongodb-enterprise-database-tools-extra.x86_64
      - mongodb-enterprise-tools.x86_64
    state: installed
    enablerepo: AFSIEP_MongoDB_Enterprise_MongoDB5-RHEL8-x86_64
    disablerepo: AFSIEP_MongoDB_Enterprise_MongoDB5-RHEL8-x86_64
    skip_broken: yes
  ignore_errors: yes
  register: yum_result

- debug: 
    var: yum_result.stdout_lines 

#
#- name: create a working directory /usr/local/bin/
#  file:
#    path: /usr/local/bin/
#    state: directory
#    owner: root
#    group: root

    #- name: copy mongo database BI into /usr/local/bin
    #  unarchive:
    #    src: https://va1artifactoryirs.mgt.afsiep.net/artifactory/Linux-Shared/MongoDB/mongodb-bi-linux-x86_64-rhel80-v2.14.4.tgz
    #    dest: /usr/local/bin/
    #    remote_src: yes
    #    list_files: yes    

#stops mongod.service so it wont look for the wrong conf file and fail#
#- name: stop mongod
#  systemd:
#    name: mongod
#    state: stopped
#    enabled: no

  #- name: disable repo services
  #  shell: subscription-manager repos --disable=AFSIEP_MongoDB_Enterprise_MongoDB5-RHEL8-x86_64   

#cleans up directories and removes unwanted files#
#- name: remove unwanted files
#  file:
#    path: "{{ item }}"
#    state: absent
#  loop:
#    - /opt/scripts/mongodb
#    - /tmp/mongo*.sock
#    - /etc/mongod.conf

