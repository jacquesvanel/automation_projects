---
- name: deploy all server config
  include_tasks: allserverconfig.yml
#starts install of config files
- name: deploy config_svr_template
  include_tasks: config_srv_template.yml
  when: "{{ item }}" 
  loop:
    - (configsvr_rsa is defined) and (ansible_hostname == configsvr_rsa)
    - (configsvr_rsb is defined) and (ansible_hostname == configsvr_rsb)
    - (configsvr_rsc is defined) and (ansible_hostname == configsvr_rsc)  

- name: deploy shard1_template
  include_tasks: shard1_template.yml
  when: "{{ item }}"
  loop:
    - (shard1a is defined) and (ansible_hostname == shard1a)
    - (shard1b is defined) and (ansible_hostname == shard1b)
    - (shard1c is defined) and (ansible_hostname == shard1c)

- name: deploy shard2_template
  include_tasks: shard2_template.yml
  when: "{{ item }}"
  loop:
    - (shard2a is defined) and (ansible_hostname == shard2a)
    - (shard2b is defined) and (ansible_hostname == shard2b)
    - (shard2c is defined) and (ansible_hostname == shard2c)

- name: deploy shard3 template
  include_tasks: shard3_template.yml
  when: "{{ item }}"
  loop:
    - (shard3a is defined) and (ansible_hostname == shard3a)
    - (shard3b is defined) and (ansible_hostname == shard3b)
    - (shard3c is defined) and (ansible_hostname == shard3c)

- name: deploy mongos_template
  include_tasks: mongos_template.yml
  when: "{{ item }}"
  loop:
    - (configsvr_rsa is defined) and (ansible_hostname == configsvr_rsa)
    - (configsvr_rsb is defined) and (ansible_hostname == configsvr_rsb)
    - (configsvr_rsc is defined) and (ansible_hostname == configsvr_rsc)

