---
# tasks file for initiate_mongo
- name: (initiate_clusters.yml) make directory for /etc/mongo/{{ env }}/scripts/
  file:
    dest: /etc/mongo/{{ env }}/scripts/
    state: directory
    owner: "{{ owner }}"
    group: "{{ group }}"

- name: (initiate_clusters.yml) layout initiate.js template on the server
  template:
    src:  initiate.js.j2
    dest: "/etc/mongo/{{ env }}/scripts/initiate.js"
    owner: root
    group: root
    mode: '0644'
    force: yes
  when: ansible_hostname == {{ item.name }}    
  with_items: "{{ db_servers }}"
  loop_control:
    label: "{{ item.name }}"
  ignore_errors: yes
  
- name: (initiate_clusters.yml) set up initiate on  server
  shell: mongo {{ ansible_fqdn }}:{{ item.port }}/admin /etc/mongo/{{ env }}/scripts/initiate.js -u amkanda -p Qwerty#12345px
  register: initiate_result
  when: ansible_hostname == {{ item.name }}
  with_items: "{{ db_servers }}"
  loop_control:
    label: "{{ item.name }}"
  ignore_errors: yes

- name: (initiate_clusters.yml) show result
  debug:
    msg: "{{ initiate_result }}"
   
  

