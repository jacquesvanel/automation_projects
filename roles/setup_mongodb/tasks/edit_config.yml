---
- name: find config files on server
  find:
    paths: "/etc/mongo/{{ env }}/"
    patterns: "*.cfg"
    recurse: yes
  register: cfgs

- name: replace security line in config file
  replace:
    path: "{{ item }}"
    regexp: '#security'
    replace: 'security'
  with_items: "{{cfgs.files | map(attribute='path')| list }}"

- name: replace  line in config file
  replace:
    path: "{{ item }}"
    regexp: '#  keyFile: "/data/prod/keyfile.pem"'
    replace: '  keyFile: "/data/prod/keyfile.pem"'
  with_items: "{{cfgs.files | map(attribute='path')| list }}"
#- name: Remove existing security line
#  lineinfile:
#    path: "/etc/mongo/{{ env }}/*.cfg"
#    regexp: '#security:'
#    state: absent

#- name: Add security line 
#  lineinfile:
#    insertbefore: '#  keyFile: "/data/{{ env }}/keyfile.pem"'
#    path: "/etc/mongo/{{ env }}/*.cfg"
#    line: 'security:'
#    state: present

#- name: Remove existing keyfile line
#  lineinfile:
#    path: /etc/mongo/{{ env }}/*.cfg
#    regexp: '#  keyFile: "/data/{{ env }}/keyfile.pem"'
#    state: absent

#- name: Add keyfile line
#  lineinfile:
#    insertafter: 'security:'
#    path: "/etc/mongo/{{ env }}/*.cfg"
#    line: '  keyFile: "/data/{{ env }}/keyfile.pem"'
#    state: present
