---
- name: initiate clusters
  include_tasks: testinitiate_clusters.yml
  when: "{{ primary }}"
  loop:
    - (ansible_hostname == shard1a)
    - (ansible_hostname == shard2a)
    - (ansible_hostname == shard3a)
    - (ansible_hostname == configsvr_rsa)
  loop_control:
    loop_var: primary

- name: start mongos
  include_tasks: start_mongos.yml
  when: "{{ start_mongos }}"
  loop:
    - (ansible_hostname == configsvr_rsa)
    - (ansible_hostname == configsvr_rsb)
    - (ansible_hostname == configsvr_rsc)
  loop_control:
    loop_var: start_mongos

- name: add shards to cluster
  include_tasks: add_shards_to_cluster.yml
  when: (ansible_hostname == configsvr_rsa)

- name: setup users
  include_tasks: user_setup.yml
  when: "{{ setup_users }}"
  loop:
    - (ansible_hostname == configsvr_rsa)
    - (ansible_hostname == shard1a)
    - (ansible_hostname == shard2a)
    - (ansible_hostname == shard3a)
  loop_control:
    loop_var: setup_users
