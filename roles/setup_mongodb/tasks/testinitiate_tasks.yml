---
- name: initiate clusters
  include_tasks: initiate_clusters.yml
  when: "{{ item }}"
  loop:
    - "(shard1a is defined) and (ansible_hostname == shard1a)"
    - "(shard2a is defined) and (ansible_hostname == shard2a)"
    - "(shard3a is defined) and (ansible_hostname == shard3a)"
    - "(configsvr_rsa is defined) and (ansible_hostname == configsvr_rsa)"

- name: start mongos
  include_tasks: start_mongos.yml
  when: "{{ item }}"
  loop:
    - "(configsvr_rsa is defined) and (ansible_hostname == configsvr_rsa)"
    - "(configsvr_rsb is defined) and (ansible_hostname == configsvr_rsb)"
    - "(configsvr_rsc is defined) and (ansible_hostname == configsvr_rsc)"
  
- name: add shards to cluster
  include_tasks: add_shards_to_cluster.yml
  when: (configsvr_rsa is defined) and (ansible_hostname == configsvr_rsa)

- name: setup users
  include_tasks: user_setup.yml
  when: "{{ item }}"
  loop:
    - "(configsvr_rsa is defined) and (ansible_hostname == configsvr_rsa)"
    - "(shard1a is defined) and (ansible_hostname == shard1a)"
    - "(shard2a is defined) and (ansible_hostname == shard2a)"
    - "(shard3a is defined) and (ansible_hostname == shard3a)"
