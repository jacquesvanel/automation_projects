---
- name: install mongodb base
  include_tasks: install_mongodb.yml
  tags: 
    - base
    - dbtools
    - install

- name: configs for all servers
  include_tasks: allserverconfig.yml
  tags: 
    - make_file
    - add_certs
    - logrotate
    - hugepages
    - mongo_service
    - install
    
- name: install configs
  include_tasks: config_tasks.yml
  tags:
    - configsvr
    - shard1
    - shard2
    - shard3
    - mongos

- name: setup users
  include_tasks: user_setup.yml
  when: 'setup_users'
  loop:
    - (configsvr_rsa is defined) and (ansible_hostname == configsvr_rsa)
    - (shard1a is defined) and (ansible_hostname == shard1a)
    - (shard2a is defined) and (ansible_hostname == shard2a)
    - (shard3a is defined) and (ansible_hostname == shard3a)
  loop_control:
    loop_var: setup_users
  tags: setup_users

- name: create role
  include_tasks: createrole.yml
  tags: 
    - create_role
    
- name: change ldap interval
  include_tasks: ldapintervalchange.yml
  tags: 
    - ldap_interval_change

- name: initiate db
  include_tasks: initiate_tasks.yml
  tags:
    - initiate_db
    - start_mongos
    - add_shards

- name: uninstall services
  include_tasks: uninstall.yml
  tags: 
    - never
    - uninstall


  #- include_tasks: restart_services.yml
  #  when: install_state == 'run_configs_only'

