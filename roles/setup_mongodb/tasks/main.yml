---
################################  testing  ################################
- name: set facts
  import_tasks: set_fact.yml
  tags:
    - always

- name: test task
  import_tasks: test.yml
  tags:
    - test
    - never

- name: uninstall services
  import_tasks: uninstall.yml
  tags:
    - never
    - uninstall
    - reinstall

##########start of config##################################################
- name: add mongo service file
  import_tasks: mongo_service.yml
  tags:
    - reinstall
    - mongo_service

- name: add configsvr config/service files 
  import_tasks: no_sec_servers.yml
  tags:
    - reinstall
    - no_sec_servers

- name: add mongos config/service files
  include_tasks: mongos.yml
  #when: 'add_mongos'
  #loop:
  #  - (configsvr_rsa is defined) and (ansible_hostname == configsvr_rsa)
  #  - (configsvr_rsb is defined) and (ansible_hostname == configsvr_rsb)
  #  - (configsvr_rsc is defined) and (ansible_hostname == configsvr_rsc)
  #loop_control:
  #  loop_var: add_mongos
  tags: 
    - reinstall
    - mongos

- name: setup users
  import_tasks: setup_users.yml
  tags: 
    - reinstall
    - setup_users

- name: create role
  import_tasks: create_role.yml
  tags: 
    - reinstall
    - create_role
    
- name: change ldap interval
  import_tasks: ldap_interval.yml
  tags:
    - reinstall
    - ldap_interval  

- name: start mongos
  include_tasks: start_mongos.yml
  #when: 'start_mongos'
  #loop:
  #  - (configsvr_rsa is defined) and (ansible_hostname == configsvr_rsa)
  #  - (configsvr_rsb is defined) and (ansible_hostname == configsvr_rsb)
  #  - (configsvr_rsc is defined) and (ansible_hostname == configsvr_rsc)
  #loop_control:
  #  loop_var: start_mongos
  tags:
    - reinstall
    - start_mongos

- name: add configsvr config/service files
  import_tasks: servers.yml
  tags:
    - reinstall
    - servers

- name: initiate clusters
  import_tasks: initiate_clusters.yml
  tags:
    - reinstall
    - initiate_clusters

- name: add keep alive line to sysctl.conf
  import_tasks: add_line_to_sys.yml
  tags:
    - reinstall
    - keepalive

- name: add shards to cluster
  import_tasks: add_shards.yml
  tags:
    - reinstall
    - add_shards

- name: start mongo
  systemd:
    name: mongo
    state: restarted
#####################################################################
- name: install sadi config
  import_tasks: sadi_dsit.yml
  tags:
    - never
    - sadi
