---
- name: start mongod on config servers 
  systemd:
    name: mongod_config
    state: restarted
  when: "{{ lookup('configsvr', ansible_loop_var) }}"
  #  loop:
  #    - "(configsvr_rsa is defined) and (ansible_hostname == configsvr_rsa)"
  #    - "(configsvr_rsb is defined) and (ansible_hostname == configsvr_rsb)"
  #    - "(configsvr_rsc is defined) and (ansible_hostname == configsvr_rsc)"

- block:      
  - name: start mongod_shard1.service
    systemd:
      name: mongod_shard1
      state: restarted
    when: "{{ lookup('shard1', ansible_loop_var) }}"
    #    loop:
    #      - "(shard1a is defined) and (ansible_hostname == shard1a)"
    #      - "(shard1b is defined) and (ansible_hostname == shard1b)"
    #      - "(shard1c is defined) and (ansible_hostname == shard1c)"
  ignore_errors: yes

- block:
  - name: start mongod_shard2.service
    systemd:
      name: mongod_shard2
      state: restarted
    when: "{{ lookup('shard2', ansible_loop_var) }}"
    #    loop:
    #      - "(shard2a is defined) and (ansible_hostname == shard2a)"
    #      - "(shard2b is defined) and (ansible_hostname == shard2b)"
    #      - "(shard2c is defined) and (ansible_hostname == shard2c)" 
  ignore_errors: yes

- block:
  - name: start mongod_shard3.service
    systemd:
      name: mongod_shard3
      state: restarted
    when: "{{ lookup('shard3', ansible_loop_var) }}"
    #    loop:
    #      - "(shard3a is defined) and (ansible_hostname == shard3a)"
    #      - "(shard3b is defined) and (ansible_hostname == shard3b)"
    #      - "(shard3c is defined) and (ansible_hostname == shard3c)"
  ignore_errors: yes

- name: start mongos
  include_tasks: start_mongos.yml
  when: "{{ lookup('configsvr', ansible_loop_var) }}"

  #- name: start mongos0
  #  systemd:
  #    name: mongos0
  #    state: restarted
  #  when: "{{ item }}"
  #  loop:
  #    - "(configsvr_rsa is defined) and (ansible_hostname == configsvr_rsa)"
  #    - "(configsvr_rsb is defined) and (ansible_hostname == configsvr_rsb)"
  #    - "(configsvr_rsc is defined) and (ansible_hostname == configsvr_rsc)"

  #- name: start mongos1
  #  systemd:
  #    name: mongos1
  #    state: restarted
  #  when: "{{ item }}"
  #  loop:
  #    - "(configsvr_rsa is defined) and (ansible_hostname == configsvr_rsa)"
  #    - "(configsvr_rsb is defined) and (ansible_hostname == configsvr_rsb)"
  #    - "(configsvr_rsc is defined) and (ansible_hostname == configsvr_rsc)"

  #- name: start mongos2.service
  #  systemd:
  #    name: mongos2
  #    state: restarted
  #  when: "{{ item }}"
  #  loop:
  #    - "(configsvr_rsa is defined) and (ansible_hostname == configsvr_rsa)"
  #    - "(configsvr_rsb is defined) and (ansible_hostname == configsvr_rsb)"
  #    - "(configsvr_rsc is defined) and (ansible_hostname == configsvr_rsc)"
