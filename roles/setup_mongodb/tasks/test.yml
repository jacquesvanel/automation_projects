---
- name: () find all automation files associated with mongo
  find:
    paths:
      - "/data/{{ env }}/config/rs_a/"
      - "/data/{{ env }}/config/rs_b/"
      - "/data/{{ env }}/config/rs_c/"
      - "/data/{{ env }}/shard1/rs_a/"
      - "/data/{{ env }}/shard1/rs_b/"
      - "/data/{{ env }}/shard1/rs_c/"
      - "/data/{{ env }}/shard2/rs_a/"
      - "/data/{{ env }}/shard2/rs_b/"
      - "/data/{{ env }}/shard2/rs_c/"
      - "/data/{{ env }}/shard3/rs_a/"
      - "/data/{{ env }}/shard3/rs_b/"
      - "/data/{{ env }}/shard3/rs_c/"
      - "/data/{{ env }}/"
    patterns: "*.conf"
    recurse: yes
  register: conf_files

- debug:
    msg: "{{ conf_files.files | map(attribute='path') | list }}"


- name: Check type of host (for SBX envi)
  shell:
    cmd: "cat {{ item }} |  grep -i 'clusterRole'"
  register: config_sbxa
  #when:
  #- envi.stdout == "sbx"
  #- config_file_rs_a_sbx.stat.exists
  with_items: "{{ conf_files.files | map(attribute='path') | list }}"
  #map('regex_replace','\\/usr\\/lib\\/systemd\\/system\\/','')| map('regex_replace','\\/etc\\/systemd\\/system\\/','') | list }}"
  ignore_errors: yes

- name: show server type (SBX envi)
  debug:
    msg: >-
       "{{ ansible_hostname }} {% if 'shardsvr' in config_sbxa.stdout %} is a REPLICASET SERVER 
        {% elif 'configsvr' in config_sbxa.stdout %} is a CONFIG SERVER 
        {% elif config_sbxa.stdout == "" %} is a REPLICASET SERVER{% endif %}"
  ignore_errors: yes
  register: replicaset_server_type_a_sbx
