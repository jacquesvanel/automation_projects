---
- name: make directory for /etc/mongo/{{ env }}/scripts/
  file:
    dest: /etc/mongo/{{ env }}/scripts/
    state: directory
    owner: "{{ owner }}"
    group: "{{ group }}"

- name: layout template for /etc/mongo/{{ env }}/scripts/add_shards_to_cluster.js. the {{ configsvr_rsa }} server
  template:
    src:  add_shards_to_cluster.js.j2
    dest: "/etc/mongo/{{ env }}/scripts/add_shards_to_cluster.js"
    owner: "{{ owner }}"
    group: "{{ group }}"
    mode: '0644'
    force: yes

- name: add shards to cluster
  shell: mongo {{ ansible_fqdn }}:{{ item.port }}/admin /etc/mongo/{{ env }}/scripts/add_shards_to_cluster.js -u amkanda -p Qwerty#12345px
  register: add_shards_result
  with_items: "{{ db_servers }}"
  when: item.name == configsvr_rsa
  ignore_errors: yes

- name: show role result
  debug:
    var: add_shards_result.stdout_lines
  ignore_errors: yes
  when: item.name == configsvr_rsa

